pipeline {
    agent any
      def mvnHome

    stages {

   stage('Preparation ') {
     steps {

      sh 'rm git clone https://github.com/Hygieia/hygieia-core.git'
      sh 'git clone https://github.com/Hygieia/Hygieia.git'
      sh 'mv hygieia-core Hygieia/hygieia-core '
      sh 'export mvnHome = tool 'M3' 
   }
   }
   stage('Build') {
        steps {

         sh 'cd Hygieia/hygieia-core/ && ${mvnHome}/bin/mvn -Dmaven.test.failure.ignore clean package'
         sh 'cd Hygieia && ${mvnHome}/bin/mvn -Dmaven.test.failure.ignore clean package'
         sh 'zip -r hygieia.zip Hygieia/ '
      }
      }

   stage('Results') {
     steps {
      junit '**/target/surefire-reports/TEST-*.xml'
      junit '**/**/target/surefire-reports/TEST-*.xml'
      junit '**/**/**/target/surefire-reports/TEST-*.xml'
      archive 'Hygieia.zip'
   }
   }
stage('Publish') {
steps {
nexusPublisher nexusInstanceId: '1', nexusRepositoryId: 'cloud9', packages: [[$class: 'MavenPackage', mavenAssetList: [], mavenCoordinate: [artifactId: 'hygieia.zip', groupId: 'hyg', packaging: 'rar', version: '1']]]
}
   }
      }
        }
